<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MFA Backup Codes</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-12 max-w-2xl">
        <div class="bg-white rounded-xl shadow-lg p-8">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-900 mb-2">New Backup Codes Generated</h1>
                <p class="text-gray-600">Save these new backup codes in a safe place</p>
            </div>

            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6 mb-6">
                <div class="flex items-start">
                    <svg class="w-6 h-6 text-yellow-600 mr-3 flex-shrink-0 mt-1" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z">
                        </path>
                    </svg>
                    <div>
                        <h3 class="font-semibold text-yellow-900 mb-2">Important Security Information</h3>
                        <ul class="text-sm text-yellow-800 space-y-1">
                            <li>‚Ä¢ Your previous backup codes have been invalidated</li>
                            <li>‚Ä¢ Each code can only be used once</li>
                            <li>‚Ä¢ Store these codes securely (password manager, encrypted file, etc.)</li>
                            <li>‚Ä¢ Don't share these codes with anyone</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="mb-6">
                <h3 class="text-xl font-semibold text-gray-900 mb-4">Your New Backup Codes:</h3>
                <div class="grid grid-cols-2 gap-3 mb-6">
                    {{range .BackupCodes}}
                    <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 font-mono text-center text-lg hover:bg-gray-100 cursor-pointer select-all"
                        onclick="copyToClipboard('{{.}}')">
                        {{.}}
                    </div>
                    {{end}}
                </div>

                <div class="flex space-x-4 mb-6">
                    <button onclick="printCodes()"
                        class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors">
                        üñ®Ô∏è Print Codes
                    </button>
                    <button onclick="downloadCodes()"
                        class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors">
                        üíæ Download as Text
                    </button>
                </div>
            </div>

            <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
                <h3 class="font-semibold text-green-900 mb-2">How to use backup codes:</h3>
                <p class="text-sm text-green-800">
                    If you lose access to your authenticator app, you can use these codes instead of the 6-digit code
                    during login.
                    Enter any unused backup code in the MFA verification screen.
                </p>
            </div>

            <div class="text-center space-y-3">
                <a href="{{uris.App}}"
                    class="block w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors">
                    Go to Dashboard
                </a>

                <form method="POST" class="inline-block">
                    <button type="submit" class="text-blue-600 hover:text-blue-800 text-sm underline">
                        Generate New Backup Codes
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Toast notification -->
    <div id="toast" class="hidden fixed top-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg z-50">
        Copied to clipboard!
    </div>

    <script>
        const backupCodes = [];

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(function () {
                showToast();
            }, function (err) {
                console.error('Could not copy text: ', err);
            });
        }

        function showToast() {
            const toast = document.getElementById('toast');
            toast.classList.remove('hidden');
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 2000);
        }

        function printCodes() {
            const printContent = `
                <html>
                <head>
                    <title>MFA Backup Codes</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .codes-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
                        .code { border: 1px solid #ccc; padding: 15px; text-align: center; font-family: monospace; font-size: 16px; }
                        .warning { background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; margin: 20px 0; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>Multi-Factor Authentication Backup Codes</h1>
                        <p>Generated on: ${new Date().toLocaleString()}</p>
                    </div>
                    <div class="warning">
                        <strong>Important:</strong> Each backup code can only be used once. Store these codes securely and don't share them with anyone.
                    </div>
                    <div class="codes-grid">
                        ${backupCodes.map(code => `<div class="code">${code}</div>`).join('')}
                    </div>
                </body>
                </html>
            `;

            const printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.focus();
            printWindow.print();
        }

        function downloadCodes() {
            const content = `Multi-Factor Authentication Backup Codes
Generated on: ${new Date().toLocaleString()}

IMPORTANT: Each backup code can only be used once. Store these codes securely and don't share them with anyone.

Your backup codes:
${backupCodes.map((code, index) => `${index + 1}. ${code}`).join('\n')}

Instructions:
- Use these codes if you lose access to your authenticator app
- Enter any unused backup code in the MFA verification screen during login
- Each code can only be used once
- Generate new codes if you run out or suspect they've been compromised`;

            const blob = new Blob([content], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = 'mfa-backup-codes.txt';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }
    </script>
</body>

</html>
